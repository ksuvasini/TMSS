@model TMSS.Web.Models.IncidentViewModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}



<h3>Add Incident</h3>
<hr />

<div class="container">

    <form asp-action="Create" id="incidentForm">
        <div class="row">
            <div class="col-md-4">

                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="form-group">
                    <label asp-for="PatientName" class="control-label"></label>
                    <input asp-for="PatientName" class="form-control" />
                    <span asp-validation-for="PatientName" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="ClinicName" class="control-label"></label>
                    <input asp-for="ClinicName" class="form-control" />
                    <span asp-validation-for="ClinicName" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="IncidentDetails" class="control-label"></label>
                    <textarea asp-for="IncidentDetails" class="form-control"></textarea>
                    <span asp-validation-for="IncidentDetails" class="text-danger"></span>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="ProcedureName" class="control-label"></label>
                    <input asp-for="ProcedureName" class="form-control" />
                    <span asp-validation-for="ProcedureName" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">

                <div class="form-group">
                    <label asp-for="Complication" class="control-label"></label>
                    <input asp-for="Complication" class="form-control" />
                    <span asp-validation-for="Complication" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">

                <div class="form-group">
                    <label asp-for="SurgeonName" class="control-label"></label>
                    <input asp-for="SurgeonName" class="form-control" />
                    <span asp-validation-for="SurgeonName" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <input type="submit" value="Save Incident" class="btn btn-primary" />
                </div>
            </div>
        </div>
    </form>


    <div class="row">
        <div class="col-xs-8">
            <form class="row gx-3 gy-2 align-items-center" id="incidentsearch">
                <div class="col-sm-3">
                    <input id="txtIncidentName" type="text" placeholder="Incident..." class="form-control" />
                </div>
                @*   <div class="col-sm-3">
                <input id="txtClinicLocation" type="text" placeholder="Location..." class="form-control" />
                </div> *@
                <div class="col-auto">
                    <button id="btnSearch" type="button" class="btn btn-outline-warning">Search</button>
                </div>
                <div class="col-auto">
                    <button id="btnClear" type="button" class="btn btn-outline-warning">Clear</button>
                </div>
                <div class="col-auto" style="margin-left: 19%;">
                    <div class="form-group">
                        @*  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                        Add New Clinic
                        </button> *@
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row" style="margin-top: 10px;">

        <table class="table" id="tblIncident">
        </table>
    </div>
</div>

@section scripts{
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/jquery.multiselect.js"></script>
    @* <script src="https://unpkg.com/gijgo@1.9.14/js/gijgo.min.js" type="text/javascript"></script> *@
    <script src="~/lib/gijgo/modular/js/grid.js"></script>
    <script src="~/lib/gijgo/modular/js/grid.min.js"></script>

    <script type="text/javascript">
        var grid, dialog;
        $(document).ready(function () {
            GetIncident();
        });

        function clearFileds() {
            $('#ClinicId').val('');
            $('#ComplicationName').val('');

        }

        $('#btnSearch').on('click', function () {
            grid.reload({ clinicName: $('#ComplicationName').val() });
        });
        $('#btnClear').on('click', function () {
            $('#txtClinicName').val('');
            $('#txtClinicLocation').val('');
            grid.reload({ clinicName: '', clinicLocation: '' });
        });
        function Edit(e) {
            // console.log(e.data);
            $('#ClinicId').val(e.data.id);
            $('#ClinicName').val(e.data.record.clinicName);
            $('#ClinicLocation').val(e.data.record.clinicLocation);
            // $('#PlaceOfBirth').val(e.data.record.PlaceOfBirth);
            // dialog.open('Edit Player');
            $('#staticBackdrop').modal('show');
        }

        function GetIncident() {
            grid = $('#tblIncident').grid({
                primaryKey: 'ID',
                dataSource: '/Incident/Get',
                uiLibrary: 'bootstrap',
                columns: [
                    { field: 'patientName', title: 'Patient Name', sortable: true },
                    { field: 'procedureName', title: 'Procedure Name', sortable: true },
                    // { field: 'PlaceOfBirth', title: 'Place Of Birth', sortable: true },
                    { title: '', field: 'Edit', width: 34, type: 'icon', icon: 'far fa-edit', tooltip: 'Edit', events: { 'click': Edit } },
                    // { title: '', field: 'Delete', width: 34, type: 'icon', icon: 'glyphicon-remove', tooltip: 'Delete', events: { 'click': Delete } }
                ],
                pager: { limit: 5, sizes: [2, 5, 10, 20] }
            });
        }

        function SaveClinic() {
            if (!$("#incidentForm").valid()) {
                return false;
            }
                
            let clinicViewModel = {
                ClinicId: $('#ClinicId').val(),
                ClinicName: $('#ClinicName').val(),
                ClinicLocation: $('#ClinicLocation').val()
                // standard: $("#StudentStd").val(),
                // city: $("#StudentCity").val(),
                //  isRegular: $("#IsRegular").is(":checked")
                //  gender: selected.length > 0 ? selected.val() : 0,
            }
            console.log(clinicViewModel);
            $.ajax({
                url: "/Clinic/Create",
                method: "POST",
                data: { clinicViewModel: clinicViewModel },
                success: function (response) {
                    $('#ClinicId').val('');
                    $('#ClinicName').val('');
                    $('#ClinicLocation').val('');
                    dialog.close();
                    grid.reload();
                    //  GetClinics();
                },
                error: function (request, status, error) {
                    alert(request.responseText);
                }
            });


        }

    </script>
    }
<br />
